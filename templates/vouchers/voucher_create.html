{% extends 'base.html' %}
{% load static %}

{% block title %}Crear Voucher - {{ site_config.site_name }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="bg-success text-white py-3" style="background-color: #48ff00 !important;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="h3 fw-bold mb-1 text-dark">
                    <i class="fas fa-plus-circle me-2"></i>Crear Nuevo Voucher
                </h1>
                <p class="mb-0 small text-dark">
                    Genera un voucher de regalo con código QR
                </p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'vouchers:list' %}" class="btn btn-dark btn-sm">
                    <i class="fas fa-arrow-left me-1"></i>Volver
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Formulario -->
<section class="py-3">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm" data-aos="zoom-in">
                    <div class="card-body p-3">
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="row g-3">
                                <!-- Información del Cliente -->
                                <div class="col-12">
                                    <h3 class="h6 mb-2 fw-bold" style="color: #df1d2e;">
                                        <i class="fas fa-user me-2"></i>Información del Cliente
                                    </h3>
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.client_name.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Nombre Completo <span class="text-danger">*</span>
                                    </label>
                                    {{ form.client_name }}
                                    {% if form.client_name.errors %}
                                    <div class="text-danger small mt-1">{{ form.client_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.client_email.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Email <span class="text-danger">*</span>
                                    </label>
                                    {{ form.client_email }}
                                    {% if form.client_email.errors %}
                                    <div class="text-danger small mt-1">{{ form.client_email.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.client_phone.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Teléfono
                                    </label>
                                    {{ form.client_phone }}
                                    {% if form.client_phone.errors %}
                                    <div class="text-danger small mt-1">{{ form.client_phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.client_id.id_for_label }}" class="form-label small fw-bold mb-1">
                                        DNI/Documento
                                    </label>
                                    {{ form.client_id }}
                                    {% if form.client_id.errors %}
                                    <div class="text-danger small mt-1">{{ form.client_id.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <!-- Detalles del Voucher -->
                                <div class="col-12 mt-4">
                                    <h3 class="h6 mb-2 fw-bold" style="color: #df1d2e;">
                                        <i class="fas fa-ticket-alt me-2"></i>Detalles del Voucher
                                    </h3>
                                </div>
                                
                                <div class="col-md-12">
                                    <label for="{{ form.voucher_type.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Tipo de Voucher <span class="text-danger">*</span>
                                    </label>
                                    {{ form.voucher_type }}
                                    {% if form.voucher_type.errors %}
                                    <div class="text-danger small mt-1">{{ form.voucher_type.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Monto Fijo | Porcentaje de Descuento | Texto Libre/Beneficio</div>
                                </div>
                                
                                <!-- Campo para voucher por MONTO FIJO -->
                                <div class="col-md-6" id="amount_field" style="display: none;">
                                    <label for="{{ form.value.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Monto Fijo <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        {{ form.value }}
                                    </div>
                                    {% if form.value.errors %}
                                    <div class="text-danger small mt-1">{{ form.value.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Ej: 5000 (equivale a $5000)</div>
                                </div>
                                
                                <!-- Campo para voucher por PORCENTAJE -->
                                <div class="col-md-6" id="percentage_field" style="display: none;">
                                    <label for="{{ form.percentage.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Porcentaje de Descuento <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">%</span>
                                        {{ form.percentage }}
                                    </div>
                                    {% if form.percentage.errors %}
                                    <div class="text-danger small mt-1">{{ form.percentage.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Ej: 50 (equivale a 50% de descuento)</div>
                                </div>
                                
                                <!-- Campo para voucher por TEXTO LIBRE -->
                                <div class="col-md-12" id="freetext_field" style="display: none;">
                                    <label for="{{ form.benefit_description.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Descripción del Beneficio <span class="text-danger">*</span>
                                    </label>
                                    {{ form.benefit_description }}
                                    {% if form.benefit_description.errors %}
                                    <div class="text-danger small mt-1">{{ form.benefit_description.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Ej: "2 horas de Paddle"</div>
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.service_type.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Tipo de Servicio
                                    </label>
                                    {{ form.service_type }}
                                    {% if form.service_type.errors %}
                                    <div class="text-danger small mt-1">{{ form.service_type.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="{{ form.validity_days.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Días de Validez <span class="text-danger">*</span>
                                    </label>
                                    {{ form.validity_days }}
                                    {% if form.validity_days.errors %}
                                    <div class="text-danger small mt-1">{{ form.validity_days.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Por defecto: 365 días (1 año)</div>
                                </div>
                                
                                <div class="col-12">
                                    <label for="{{ form.description.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Descripción del Servicio
                                    </label>
                                    {{ form.description }}
                                    {% if form.description.errors %}
                                    <div class="text-danger small mt-1">{{ form.description.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Describe qué incluye este voucher</div>
                                </div>
                                
                                <div class="col-12">
                                    <label for="{{ form.notes.id_for_label }}" class="form-label small fw-bold mb-1">
                                        Notas Internas
                                    </label>
                                    {{ form.notes }}
                                    {% if form.notes.errors %}
                                    <div class="text-danger small mt-1">{{ form.notes.errors.0 }}</div>
                                    {% endif %}
                                    <div class="form-text">Notas privadas para uso interno (no visibles en el voucher)</div>
                                </div>
                            </div>
                            
                            <hr class="my-3">
                            
                            <div class="text-center">
                                <button type="submit" class="btn btn-sm px-4 me-2 text-dark" style="background-color: #48ff00;">
                                    <i class="fas fa-save me-1"></i>Crear Voucher
                                </button>
                                <a href="{% url 'vouchers:list' %}" class="btn btn-outline-secondary btn-sm px-4">
                                    <i class="fas fa-times me-1"></i>Cancelar
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Info Card -->
<section class="py-3 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm" data-aos="fade-up">
                    <div class="card-body p-3">
                        <h3 class="h6 text-primary mb-2 fw-bold">
                            <i class="fas fa-info-circle me-2"></i>Información Importante
                        </h3>
                        <ul class="mb-0 small">
                            <li><strong>Voucher por Monto:</strong> El cliente puede canjear el valor monetario en cualquier servicio del camping</li>
                            <li><strong>Voucher por Beneficio:</strong> El cliente recibe un servicio o descuento específico (ej: 2 horas de Paddle, 50% descuento)</li>
                            <li>El código QR se generará automáticamente al crear el voucher</li>
                            <li>El voucher puede ser usado solo una vez</li>
                            <li>Después de la fecha de expiración, el voucher no podrá ser usado</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const voucherTypeSelect = document.getElementById('voucher_type');
    const amountField = document.getElementById('amount_field');
    const percentageField = document.getElementById('percentage_field');
    const freetextField = document.getElementById('freetext_field');
    const valueInput = document.getElementById('amount_value');
    const percentageInput = document.getElementById('percentage_value');
    const benefitInput = document.getElementById('benefit_desc');
    
    function toggleFields() {
        const selectedType = voucherTypeSelect.value;
        
        // Ocultar todos los campos primero
        amountField.style.display = 'none';
        percentageField.style.display = 'none';
        freetextField.style.display = 'none';
        valueInput.required = false;
        percentageInput.required = false;
        benefitInput.required = false;
        
        // Mostrar y requerir el campo correspondiente
        if (selectedType === 'amount') {
            amountField.style.display = 'block';
            valueInput.required = true;
        } else if (selectedType === 'percentage') {
            percentageField.style.display = 'block';
            percentageInput.required = true;
        } else if (selectedType === 'free_text') {
            freetextField.style.display = 'block';
            benefitInput.required = true;
        }
    }
    
    // Ejecutar al cargar y al cambiar
    voucherTypeSelect.addEventListener('change', toggleFields);
    toggleFields(); // Ejecutar inmediatamente
});
</script>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    input[type="text"], input[type="email"], input[type="number"], input[type="date"], textarea, select {
        width: 100%;
    }
    .form-control, .form-select {
        border-radius: 0.5rem;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
    }
    .form-control:focus, .form-select:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
</style>
{% endblock %}
